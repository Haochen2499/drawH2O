{"version":3,"sources":["webpack:///./src/views/userInfo/UserInfo.view.vue?9893","webpack:///./src/utils/upload.js","webpack:///src/views/userInfo/UserInfo.view.vue","webpack:///./src/views/userInfo/UserInfo.view.vue?26e9","webpack:///./src/views/userInfo/UserInfo.view.vue","webpack:///./src/views/userInfo/UserInfo.view.vue?af3e"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","form","attrs","imgUrl","avatar","_m","on","e","handleUpload","isEditTitle","staticStyle","model","value","callback","$$v","$set","expression","$event","_v","handleEditUserName","_s","userInfo","userName","email","staticRenderFns","file","type","console","log","formData","FormData","append","url","fetch","post","res","error_code","success","data","error","error_msg","name","components","computed","created","methods","host","component"],"mappings":"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","file":"js/UserInfo.6c05a385.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"container\"},[_c('div',{staticClass:\"base-info\"},[_c('div',{staticClass:\"card\"},[_c('div',{staticClass:\"left\"},[(_vm.form.avatar)?_c('img',{staticClass:\"avatar\",attrs:{\"src\":_vm.imgUrl(_vm.form.avatar)}}):_c('img',{staticClass:\"avatar\",attrs:{\"src\":require(\"@assets/user/avatar.png\")}}),_vm._m(0),_c('input',{attrs:{\"type\":\"file\",\"id\":\"avatar\",\"accept\":\".jpe, .jpeg, .png\"},on:{\"change\":function (e) { return _vm.handleUpload(e); }}})]),_c('div',{staticClass:\"right\"},[_c('div',{staticClass:\"account-info\"},[_c('div',{staticClass:\"title\"},[(!_vm.isEditTitle)?[_c('p',{staticClass:\"title-text\"},[_vm._v(\" \"+_vm._s(_vm.userInfo.userName || \"\")+\" \"),_c('Icon',{attrs:{\"type\":\"md-brush\"},on:{\"click\":function($event){_vm.isEditTitle = true}}})],1)]:[_c('div',{staticClass:\"input-wrap\"},[_c('Input',{staticStyle:{\"flex\":\"1\"},attrs:{\"placeholder\":\"请输入用户名\",\"maxlength\":\"20\",\"show-word-limit\":\"\"},model:{value:(_vm.form.userName),callback:function ($$v) {_vm.$set(_vm.form, \"userName\", $$v)},expression:\"form.userName\"}}),_c('span',{staticClass:\"cancel\",on:{\"click\":function($event){_vm.isEditTitle = false}}},[_vm._v(\"取消\")]),_c('span',{staticClass:\"confirm\",on:{\"click\":_vm.handleEditUserName}},[_vm._v(\"确认\")])],1)]],2),_c('p',{staticClass:\"mail\"},[_vm._v(_vm._s(_vm.userInfo.email))])])])])])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('label',{staticClass:\"upload-wrap\",attrs:{\"for\":\"avatar\"}},[_c('div',{staticClass:\"upload-text\"},[_vm._v(\"上传头像\")])])}]\n\nexport { render, staticRenderFns }","import fetch from \"./fetch\";\nimport { Message } from \"view-design\";\nexport default async (file, type = \"image\") => {\n  console.log(file);\n  if (!file) {\n    return;\n  }\n  let formData = new FormData();\n  formData.append(\"file\", file);\n  let url;\n  switch (type) {\n    case \"image\":\n      url = \"/api/upload/image\";\n      break;\n    default:\n      break;\n  }\n  const res = await fetch.post(url, formData);\n  if (res.error_code === 0) {\n    Message.success(\"上传成功\");\n    return res.data.url;\n  } else {\n    Message.error(res.data.error_msg);\n    return null;\n  }\n};\n","<template>\n  <div class=\"container\">\n    <div class=\"base-info\">\n      <div class=\"card\">\n        <div class=\"left\">\n          <img :src=\"imgUrl(form.avatar)\" class=\"avatar\" v-if=\"form.avatar\" />\n          <img src=\"@assets/user/avatar.png\" class=\"avatar\" v-else />\n          <label class=\"upload-wrap\" for=\"avatar\">\n            <div class=\"upload-text\">上传头像</div>\n          </label>\n          <input @change=\"e => handleUpload(e)\" type=\"file\" id=\"avatar\" accept=\".jpe, .jpeg, .png\" />\n        </div>\n        <div class=\"right\">\n          <div class=\"account-info\">\n            <div class=\"title\">\n              <template v-if=\"!isEditTitle\">\n                <p class=\"title-text\">\n                  {{ userInfo.userName || \"\" }}\n                  <Icon type=\"md-brush\" @click=\"isEditTitle = true\" />\n                </p>\n              </template>\n              <template v-else>\n                <div class=\"input-wrap\">\n                  <Input\n                    v-model=\"form.userName\"\n                    placeholder=\"请输入用户名\"\n                    maxlength=\"20\"\n                    show-word-limit\n                    style=\"flex: 1\"\n                  />\n                  <span class=\"cancel\" @click=\"isEditTitle = false\">取消</span>\n                  <span class=\"confirm\" @click=\"handleEditUserName\">确认</span>\n                </div>\n              </template>\n            </div>\n            <p class=\"mail\">{{ userInfo.email }}</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapState } from \"vuex\";\nimport { Icon, Input } from \"view-design\";\nimport Upload from \"@utils/upload\";\nimport fetch from \"@utils/fetch\";\nimport { mapActions } from \"vuex\";\nexport default {\n  name: \"UserInfo\",\n  components: { Icon, Input },\n  data() {\n    return {\n      isEditTitle: \"\",\n      form: {\n        userName: \"\",\n        avatar: \"\"\n      }\n    };\n  },\n  computed: {\n    ...mapState({\n      userInfo: state => state.userInfo\n    })\n  },\n  created() {\n    if (this.userInfo) {\n      this.form.userName = this.userInfo.userName;\n      this.form.avatar = this.userInfo.avatar;\n    }\n  },\n  methods: {\n    ...mapActions({\n      getUserInfo: \"getUserInfo\"\n    }),\n    async handleUpload(e) {\n      const file = e.target.files[0];\n      const size = file.size / 1024; // 单位 kb\n      const limit = 600;\n      if (size > limit) {\n        this.$Message.error(`文件大小不能大于${limit}KB`);\n        return;\n      }\n      const res = await Upload(file);\n      console.log(res);\n      if (res) {\n        this.form.avatar = res;\n        this.updateAvatar();\n      }\n    },\n    async updateAvatar() {\n      let res = await fetch.post(\"/api/user/update\", {\n        avatar: this.form.avatar\n      });\n      if (res.error_code === 0) {\n        this.getUserInfo();\n      }\n    },\n    async handleEditUserName() {\n      if (!this.form.userName) {\n        this.$Message.error(\"用户名不能为空\");\n        return;\n      }\n      let res = await fetch.post(\"/api/user/update\", {\n        userName: this.form.userName\n      });\n      if (res.error_code === 0) {\n        this.isEditTitle = false;\n        this.getUserInfo();\n        this.$Message.success(\"更改成功\");\n      }\n    },\n    imgUrl(url) {\n      const host =\n        process.env.NODE_ENV === \"development\" ? \"http://localhost:9527\" : \"\";\n      return host + url;\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"../../styles/reset.scss\";\n.container {\n  background-color: $bg-color;\n  height: calc(100% - 60px);\n  overflow: scroll;\n  padding: 0 20vw;\n  .base-info {\n    margin-top: 20px;\n    .card {\n      width: 80%;\n      display: flex;\n      height: 250px;\n      background-color: #fff;\n      .left {\n        width: 250px;\n        height: 250px;\n        position: relative;\n        .avatar {\n          width: 100%;\n          height: 100%;\n        }\n        .upload-wrap {\n          position: absolute;\n          bottom: 0;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          transition: all ease 0.3s;\n          width: 100%;\n          height: 100%;\n          background-color: transparent;\n          cursor: pointer;\n          .upload-text {\n            display: none;\n            font-size: 16px;\n            letter-spacing: 2px;\n            font-weight: 500;\n            color: #fff;\n          }\n          &:hover {\n            background-color: #00000040;\n            .upload-text {\n              display: inline;\n            }\n          }\n        }\n        input[type=\"file\"] {\n          display: none;\n        }\n      }\n      .right {\n        padding: 15px;\n        display: flex;\n        flex: 1;\n        .account-info {\n          width: 100%;\n        }\n        .title {\n          width: 100%;\n          p {\n            color: #333;\n            font-size: 26px;\n            i {\n              font-size: 12px;\n              vertical-align: middle;\n              cursor: pointer;\n            }\n          }\n          .input-wrap {\n            display: flex;\n            align-items: center;\n            .confirm,\n            .cancel {\n              font-size: 12px;\n              margin-left: 5px;\n              color: #999;\n              cursor: pointer;\n              color: $main-color;\n            }\n          }\n        }\n        .mail {\n          color: #999;\n        }\n      }\n    }\n  }\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserInfo.view.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserInfo.view.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./UserInfo.view.vue?vue&type=template&id=fe07effc&scoped=true&\"\nimport script from \"./UserInfo.view.vue?vue&type=script&lang=js&\"\nexport * from \"./UserInfo.view.vue?vue&type=script&lang=js&\"\nimport style0 from \"./UserInfo.view.vue?vue&type=style&index=0&id=fe07effc&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"fe07effc\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserInfo.view.vue?vue&type=style&index=0&id=fe07effc&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./UserInfo.view.vue?vue&type=style&index=0&id=fe07effc&lang=scss&scoped=true&\""],"sourceRoot":""}